<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stef Coach</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, #333333, #003087, #D4A017);
            color: #FFFFFF;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        .form-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            width: 80%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            display: block;
        }
        input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #FFFFFF;
            padding: 12px;
            margin: 8px 0;
            width: 100%;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
        }
        input:focus {
            box-shadow: 0 0 8px rgba(212, 160, 23, 0.5);
            outline: none;
            border-color: #D4A017;
        }
        button {
            background: linear-gradient(135deg, #003087, #D4A017);
            border: none;
            color: #FFFFFF;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            transition: box-shadow 0.3s, transform 0.2s;
        }
        button:hover {
            box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            width: 80%;
        }
        .week-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            animation: float 4s ease-in-out infinite;
        }
        .week-card h3 {
            margin-top: 0;
            font-size: 1.2rem;
        }
        .week-card p {
            margin: 8px 0;
            font-size: 0.9rem;
        }
        .total-km {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            width: 80%;
            max-width: 600px;
            margin-top: 20px;
            text-align: center;
        }
        .total-km h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        @media (max-width: 768px) {
            .form-container, .results, .total-km {
                width: 100%;
            }
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <h1>Stef Coach</h1>
    <div class="form-container">
        <label>5K Time (mm:ss)</label>
        <input id="5k" placeholder="e.g. 20:00">
        <label>10K Time (mm:ss)</label>
        <input id="10k" placeholder="e.g. 42:00">
        <label>Half Marathon Time (hh:mm:ss)</label>
        <input id="hm" placeholder="e.g. 1:35:00">
        <label>Marathon Time (hh:mm:ss)</label>
        <input id="m" placeholder="e.g. 3:30:00">
        <label>Number of Weeks</label>
        <input id="weeks" type="number" placeholder="e.g. 12">
        <label>Weekly Increase % (e.g. 5 for 5%)</label>
        <input id="weekly_increase" type="number" placeholder="e.g. 5">
        <label>Total km (for base week)</label>
        <input id="total_km" type="number" placeholder="e.g. 60">
        <label>Easy % (e.g. 60 for 60%)</label>
        <input id="easy_percent" type="number" placeholder="e.g. 60">
        <label>Threshold % (e.g. 20 for 20%)</label>
        <input id="thresh_percent" type="number" placeholder="e.g. 20">
        <label>Interval % (e.g. 10 for 10%)</label>
        <input id="inter_percent" type="number" placeholder="e.g. 10">
        <label>Repetition % (e.g. 10 for 10%)</label>
        <input id="rep_percent" type="number" placeholder="e.g. 10">
        <button onclick="createProgram()">Δημιουργία Προγράμματος</button>
    </div>
    <div class="results" id="results"></div>
    <div class="total-km" id="total-km"></div>
    <script>
        function parseTime(str) {
            if (!str) return 0;
            let parts = str.split(':');
            let seconds = 0;
            if (parts.length === 2) {
                seconds = parseInt(parts[0]) * 60 + parseInt(parts[1]);
            } else if (parts.length === 3) {
                seconds = parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]);
            }
            return seconds;
        }
        function calculateVDOT(distance, time_seconds) {
            if (time_seconds <= 0) return 0;
            let t = time_seconds / 60;
            let v = distance / t;
            let re = -4.6 + 0.182258 * v + 0.000104 * v * v;
            let percent = 0.8 + 0.1894393 * Math.exp(-0.012778 * t) + 0.2989558 * Math.exp(-0.1932605 * t);
            return re / percent;
        }
        function getPace(vdot, f) {
            let vo2 = vdot * f;
            let a = 0.000104;
            let b = 0.182258;
            let c = -(4.6 + vo2);
            let disc = b * b - 4 * a * c;
            if (disc < 0) return 0;
            let v = (-b + Math.sqrt(disc)) / (2 * a);
            return 1000 / v;
        }
        function formatPace(pace) {
            if (pace === 0) return 'N/A';
            let min = Math.floor(pace);
            let sec = Math.round((pace - min) * 60);
            if (sec < 10) sec = '0' + sec;
            return `${min}:${sec}`;
        }
        function createProgram() {
            const distances = {
                '5k': 5000,
                '10k': 10000,
                'hm': 21097.5,
                'm': 42195
            };
            let vdots = [];
            ['5k', '10k', 'hm', 'm'].forEach(id => {
                let time_str = document.getElementById(id).value;
                let time = parseTime(time_str);
                if (time > 0) {
                    vdots.push(calculateVDOT(distances[id], time));
                }
            });
            let vdot = vdots.length > 0 ? Math.max(...vdots) : 0;
            if (vdot === 0) {
                alert('Παρακαλώ εισάγετε τουλάχιστον μία επίδοση.');
                return;
            }
            let weeks = parseInt(document.getElementById('weeks').value);
            if (isNaN(weeks) || weeks <= 0) {
                alert('Εισάγετε έγκυρο αριθμό εβδομάδων.');
                return;
            }
            let weekly_increase = parseFloat(document.getElementById('weekly_increase').value) || 0;
            if (weekly_increase < 0) {
                alert('Το ποσοστό εβδομαδιαίας αύξησης πρέπει να είναι μη αρνητικό.');
                return;
            }
            let total_km = parseFloat(document.getElementById('total_km').value) || 0;
            let easy_percent = parseFloat(document.getElementById('easy_percent').value) || 0;
            let thresh_percent = parseFloat(document.getElementById('thresh_percent').value) || 0;
            let inter_percent = parseFloat(document.getElementById('inter_percent').value) || 0;
            let rep_percent = parseFloat(document.getElementById('rep_percent').value) || 0;
            let total_percent = easy_percent + thresh_percent + inter_percent + rep_percent;
            if (total_km <= 0) {
                alert('Εισάγετε έγκυρα συνολικά χιλιόμετρα.');
                return;
            }
            if (total_percent !== 100) {
                alert('Το άθροισμα των ποσοστών πρέπει να είναι 100%.');
                return;
            }
            let easy_km = total_km * (easy_percent / 100);
            let thresh_km = total_km * (thresh_percent / 100);
            let inter_km = total_km * (inter_percent / 100);
            let rep_km = total_km * (rep_percent / 100);
            let f_easy = 0.65;
            let f_thresh = 0.91;
            let f_inter = 1.0;
            let f_rep = 1.08;
            let pace_easy = getPace(vdot, f_easy);
            let pace_thresh = getPace(vdot, f_thresh);
            let pace_inter = getPace(vdot, f_inter);
            let pace_rep = getPace(vdot, f_rep);
            let results = document.getElementById('results');
            let totalKmDisplay = document.getElementById('total-km');
            results.innerHTML = '';
            totalKmDisplay.innerHTML = '';
            let totalKmSum = 0;
            let prev_total_km = total_km;
            let increase_factor = 1 + (weekly_increase / 100);
            for (let w = 1; w <= weeks; w++) {
                let scale;
                if (w === weeks - 1) {
                    scale = 0.75; // 25% reduction for second-to-last week
                } else if (w === weeks) {
                    scale = 0.5; // 50% reduction for last week
                } else {
                    scale = Math.pow(increase_factor, w - 1); // Custom % increase
                }
                let total_w = prev_total_km * scale;
                let easy_w = easy_km * scale;
                let thresh_w = thresh_km * scale;
                let inter_w = inter_km * scale;
                let rep_w = rep_km * scale;
                totalKmSum += total_w;
                let card = document.createElement('div');
                card.className = 'week-card';
                card.innerHTML = `
                    <h3>Εβδομάδα ${w} ${w >= weeks - 1 ? '(Tapering)' : ''}</h3>
                    <p>Συνολικά km: ${total_w.toFixed(1)}</p>
                    <p>Easy: ${easy_w.toFixed(1)} km at ${formatPace(pace_easy)} /km</p>
                    <p>Threshold: ${thresh_w.toFixed(1)} km at ${formatPace(pace_thresh)} /km</p>
                    <p>Interval: ${inter_w.toFixed(1)} km at ${formatPace(pace_inter)} /km</p>
                    <p>Repetition: ${rep_w.toFixed(1)} km at ${formatPace(pace_rep)} /km</p>
                `;
                results.appendChild(card);
                prev_total_km = total_w;
                easy_km = easy_w;
                thresh_km = thresh_w;
                inter_km = inter_w;
                rep_km = rep_w;
            }
            totalKmDisplay.innerHTML = `<h3>Συνολικά χιλιόμετρα προγράμματος: ${totalKmSum.toFixed(1)} km</h3>`;
        }
    </script>
</body>
</html>
